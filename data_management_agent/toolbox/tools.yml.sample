# Toolbox configuration for Data Management Agent
# target table: company_master
# columns: id (INT), name (string), corporate_number (string), location (string), deleted_at (DATE)

sources:
  my-bigquery-source:
    kind: bigquery
    project: { YOUR_PROJECT_ID }
    location: asia-northeast1
toolsets:
  company-master-management:
    - init-company-master
    - list-companies
    - search-companies-by-name
    - search-companies-by-location
    - add-company
    - delete-company
    - update-company-name
    - update-company-corporate-number
tools:
  init-company-master:
    kind: bigquery-sql
    source: my-bigquery-source
    description: (Test) Initialize the company_master table.
    statement: |
      CREATE OR REPLACE TABLE `data_management_agent.company_master` AS
      SELECT
        (GENERATE_UUID()) AS id,
        'A株式会社' AS name,
        '0000000000000' AS corporate_number,
        '東京都港区1-1-1' AS location,
        NULL AS deleted_at
      UNION ALL
      SELECT
        (GENERATE_UUID()) AS id,
        'B株式会社' AS name,
        '0000000000001' AS corporate_number,
        '東京都港区2-2-2' AS location,
        NULL AS deleted_at
      UNION ALL
      SELECT
        (GENERATE_UUID()) AS id,
        'C株式会社' AS name,
        '0000000000002' AS corporate_number,
        '東京都港区3-3-3' AS location,
        NULL AS deleted_at
      UNION ALL
      SELECT
        (GENERATE_UUID()) AS id,
        'C株式会社' AS name,
        '0000000000002' AS corporate_number,
        '東京都港区3-3-3' AS location,
        NULL AS deleted_at
      UNION ALL
      SELECT
        (GENERATE_UUID()) AS id,
        'D株式会社' AS name,
        '0000000000003' AS corporate_number,
        '東京都品川区3-3-3' AS location,
        NULL AS deleted_at
      UNION ALL
      SELECT
        (GENERATE_UUID()) AS id,
        'E株式会社' AS name,
        '0000000000004' AS corporate_number,
        '東京都品川区3-3-3' AS location,
        CURRENT_DATE() AS deleted_at
      ;
  list-companies:
    kind: bigquery-sql
    source: my-bigquery-source
    description: List all companies in the company_master table.
    statement: |
      SELECT
        id,
        name,
        corporate_number,
        location,
        deleted_at
      FROM
        `data_management_agent.company_master`
      WHERE
        deleted_at IS NULL
      ;
  search-companies-by-name:
    kind: bigquery-sql
    source: my-bigquery-source
    description: Search companies by name in the company_master table.
    parameters:
      - name: name_keyword
        type: string
        description: Keyword to search in company names.
    statement: |
      SELECT
        id,
        name,
        corporate_number,
        location,
        deleted_at
      FROM
        `data_management_agent.company_master`
      WHERE
        name LIKE CONCAT('%', @name_keyword, '%')
        AND deleted_at IS NULL
      ;
  search-companies-by-location:
    kind: bigquery-sql
    source: my-bigquery-source
    description: Search companies by location in the company_master table.
    parameters:
      - name: location_keyword
        type: string
        description: Keyword to search in company locations.
    statement: |
      SELECT
        id,
        name,
        corporate_number,
        location,
        deleted_at
      FROM
        `data_management_agent.company_master`
      WHERE
        location LIKE CONCAT('%', @location_keyword, '%')
        AND deleted_at IS NULL
      ;
  add-company:
    kind: bigquery-sql
    source: my-bigquery-source
    description: Add a new company to the company_master table.
    parameters:
      - name: name
        type: string
        description: Name of the company.
      - name: corporate_number
        type: string
        description: Corporate number of the company.
      - name: location
        type: string
        description: Location of the company.
    statement: |
      INSERT INTO `data_management_agent.company_master` (id, name, corporate_number, location, deleted_at)
      VALUES (GENERATE_UUID(), @name, @corporate_number, @location, NULL)
      ;
  delete-company:
    kind: bigquery-sql
    source: my-bigquery-source
    description: Soft delete a company from the company_master table.
    parameters:
      - name: company_id
        type: string
        description: ID of the company to delete.
    statement: |
      UPDATE `data_management_agent.company_master`
      SET deleted_at = CURRENT_DATE()
      WHERE id = @company_id
      ;
  update-company-name:
    kind: bigquery-sql
    source: my-bigquery-source
    description: Update the name of a company in the company_master table.
    parameters:
      - name: company_id
        type: string
        description: ID of the company to update.
      - name: new_name
        type: string
        description: New name for the company.
    statement: |
      UPDATE `data_management_agent.company_master`
      SET name = @new_name
      WHERE id = @company_id
      ;
  update-company-corporate-number:
    kind: bigquery-sql
    source: my-bigquery-source
    description: Update the corporate number of a company in the company_master table.
    parameters:
      - name: company_id
        type: string
        description: ID of the company to update.
      - name: new_corporate_number
        type: string
        description: New corporate number for the company.
    statement: |
      UPDATE `data_management_agent.company_master`
      SET corporate_number = @new_corporate_number
      WHERE id = @company_id
      ;
